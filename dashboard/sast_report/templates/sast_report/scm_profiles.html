{% extends 'sast_report/base.html' %}

{% block title %}SCM Profiles{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">SCM Profiles</h1>
    <p class="text-gray-600">Manage your source code management profiles</p>
</div>

<!-- Add SCM Profile Form -->
<div class="bg-white rounded-lg shadow p-6 mb-8">
    <h2 class="text-xl font-semibold mb-4">Add New SCM Profile</h2>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">SCM Type</label>
                <select name="scm_type" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    <option value="">Select SCM...</option>
                    <option value="github">GitHub</option>
                    <option value="gitlab">GitLab</option>
                    <option value="bitbucket">Bitbucket</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Access Token</label>
                <input type="text" name="token" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your token" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Username (Optional)</label>
                <input type="text" name="username" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your username">
            </div>
        </div>
        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg">
            <i class="fas fa-plus mr-2"></i>Add Profile
        </button>
    </form>
</div>

<!-- Existing Profiles -->
<div class="bg-white rounded-lg shadow">
    <div class="p-6 border-b">
        <h2 class="text-xl font-semibold">Your SCM Profiles</h2>
    </div>
    <div class="p-6">
        {% if profiles %}
            <div class="space-y-4">
                {% for profile in profiles %}
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-lg">{{ profile.scm_type|title }}</h3>
                            <p class="text-gray-600">
                                {% if profile.username %}@{{ profile.username }}{% else %}No username set{% endif %}
                            </p>
                            <p class="text-sm text-gray-500 mt-1">
                                Created: {{ profile.created_at|date:"M d, Y" }}
                                â€¢ 
                                <span class="{% if profile.is_active %}text-green-600{% else %}text-red-600{% endif %}">
                                    {{ profile.is_active|yesno:"Active,Inactive" }}
                                </span>
                            </p>
                        </div>
                        <div class="flex space-x-2">
                            <!-- Update Token Form -->
                            <form method="post" class="flex items-center">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="update">
                                <input type="hidden" name="profile_id" value="{{ profile.id }}">
                                <input type="text" name="token" placeholder="New token" class="border border-gray-300 rounded px-2 py-1 text-sm mr-2" required>
                                <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-3 rounded text-sm">
                                    Update Token
                                </button>
                            </form>
                            <!-- Delete Form -->
                            <form method="post">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="profile_id" value="{{ profile.id }}">
                                <button type="submit" class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-sm" 
                                        onclick="return confirm('Are you sure you want to delete this profile?')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-3 rounded text-sm">
                        <strong>Token Preview:</strong> 
                        {{ profile.token|slice:":10" }}...{{ profile.token|slice:"-4:" }}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8">
                <i class="fas fa-github text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500">No SCM profiles configured yet.</p>
                <p class="text-gray-400 text-sm mt-2">Add your first SCM profile above to get started.</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="mt-6">
    <a href="{% url 'sast_report:dashboard' %}" class="text-blue-500 hover:text-blue-600">
        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
    </a>
</div>
{% endblock %}
